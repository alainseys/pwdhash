<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Password Validator & SHA-256 Hash</title>
    <style>
        body {font-family: Arial, sans-serif; max-width: 600px; margin: 2rem auto; padding: 1rem;}
        .alert {background:#fff3cd; border:1px solid #ffeaa7; padding:1rem; margin-bottom:1rem; border-radius:4px;}
        .error {background:#f8d7da; border:1px solid #f5c6cb; color:#721c24; padding:0.75rem; margin:0.5rem 0; border-radius:4px;}
        .success {background:#d4edda; border:1px solid #c3e6cb; color:#155724; padding:0.75rem; margin:0.5rem 0; border-radius:4px;}
        .result {background:#d1ecf1; border:1px solid #bee5eb; padding:1rem; margin-top:1rem; border-radius:4px;}
        .hidden {display:none;}
        input[type=password], input[type=text] {width:100%; padding:0.5rem; font-family:monospace; box-sizing:border-box;}
        button {margin-top:0.5rem; padding:0.5rem 1rem;}
        label {display:block; margin-top:1rem; font-weight:bold;}
    </style>
</head>
<body>
    <h1>Password Validator & SHA-256 Hash</h1>

    <div class="alert">
        <strong>Warning:</strong> Once you submit a valid password, its <strong>SHA-256 hash will be shown only once</strong>.
        You get <strong>one chance to copy it</strong>. After that, the page clears.
    </div>

    <form method="post">
        <label for="password">Enter Your Password:</label>
        <input type="password" id="password" name="password" required minlength="5" placeholder="Min 5 chars, 1 CAP, 1 num, 1 special">

        <button type="submit" name="action" value="check">Validate & Hash</button>
    </form>

    <!-- Show validation errors -->
    {% if errors %}
        <div class="error">
            <strong>Password does not meet requirements:</strong>
            <ul>
                {% for err in errors %}
                <li>{{ err }}</li>
                {% endfor %}
            </ul>
        </div>
    {% endif %}

    <!-- Show result ONCE -->
    {% if hash_value %}
    <div class="result" id="result">
        <p class="success">Password is valid!</p>
        <p><strong>SHA-256 Hash:</strong></p>
        <input type="text" id="hash" value="{{ hash_value }}" readonly>
        <button onclick="copyHash()">Copy Hash</button>
        <p id="copyMsg" class="hidden">Hash copied! Page clears in 3 seconds.</p>
    </div>

    <script>
        function copyHash() {
            const input = document.getElementById('hash');
            input.select();
            document.execCommand('copy');
            document.getElementById('copyMsg').classList.remove('hidden');
            setTimeout(() => { window.location.href = '/'; }, 3000);
        }
        // Safety timeout
        setTimeout(() => { window.location.href = '/'; }, 30000);
    </script>
    {% endif %}
</body>
</html>
